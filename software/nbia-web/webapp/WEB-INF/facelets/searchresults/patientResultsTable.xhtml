<?xml version="1.0" encoding="UTF-8"?>

<!--L
   Copyright SAIC, Ellumen and RSNA (CTP)


   Distributed under the OSI-approved BSD 3-Clause License.
   See http://ncip.github.com/national-biomedical-image-archive/LICENSE.txt for details.
L-->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ice="http://www.icesoft.com/icefaces/component">

<f:subview id="notWaitingView">
<!--  ensure this is in naming container so resultTable isnt dupe -->  
<!--  regular search results  -->
<ice:panelGroup id="patientResultsPanelGroup" rendered="#{not searchResultBean.textResult}">
  <ice:dataTable id="patientResultsTable" 
                 value="#{perNodeResult.patients}" 
                 var="result" 
                 rows="#{searchResultBean.resultsPerPage}" 
                 scrollable="true" scrollHeight="43.3em"
                 style="border:none;padding-top: 0px;  margin: 0px 0 0 0; text-align: center;"
                 styleClass="contentPage"
                 sortColumn="#{searchResultBean.sortColumnName}"
        	 sortAscending="#{searchResultBean.ascending}"
                 columnWidths="55em,35%,12%,10%,12%,10%,5%">
    <h:column id="collectionIdColumn">
      <f:facet name="header">
        <h:panelGroup>
       		<ice:commandSortHeader columnName="#{searchResultBean.collectionNameHeader}" arrow="true" >
				<ice:outputText value="#{searchResultBean.collectionNameHeader}" />
			</ice:commandSortHeader>
        </h:panelGroup>
      </f:facet>
      <div class="#{empty basketBean.patientInBasketMap[result.basketKey] ? '' : 'highlightedData'}">
        <h:outputText value="#{result.patient.project}" />
      </div>
    </h:column>
    <h:column id="subjectIdColumn" style="text-align:center;">
          <f:facet name="header">
            <h:panelGroup>
    		<ice:commandSortHeader columnName="#{searchResultBean.patientHeader}" arrow="true" >
    		<ice:outputText value="#{searchResultBean.patientHeader}"/>
    	</ice:commandSortHeader>         
            </h:panelGroup>
          </f:facet>
          <div class="#{empty basketBean.patientInBasketMap[result.basketKey] ? '' : 'highlightedData'}">
            <h:commandLink id="viewPatientLink"
    	                       value="#{result.patient.subjectId}"
    	                       action="#{perNodeResult.navPatient}"
                           actionListener="#{perNodeResult.viewPatient}" />
          </div>
    </h:column>
    <h:column id="matchStudiesCountColumn">
      <f:facet name="header">
        <h:panelGroup>
          <ice:commandSortHeader columnName="#{searchResultBean.matchedStudyHeader}" arrow="true" >
	      		<ice:outputText value="#{searchResultBean.matchedStudyHeader}"/>
    	</ice:commandSortHeader>
        </h:panelGroup>
      </f:facet>
      <div class="#{empty basketBean.patientInBasketMap[result.basketKey] ? '' : 'highlightedData'}">
        <h:outputText value="#{result.studyCounts}"  />
      </div>
    </h:column>
    <h:column id="totalStudiesCountColumn">
          <f:facet name="header">
            <h:panelGroup>
             <ice:commandSortHeader columnName="#{searchResultBean.totalStudyHeader}" arrow="true" >
	         		<ice:outputText value="#{searchResultBean.totalStudyHeader}"/>
    	</ice:commandSortHeader>
            </h:panelGroup>
          </f:facet>
          <div class="#{empty basketBean.patientInBasketMap[result.basketKey] ? '' : 'highlightedData'}">
            <h:outputText value="#{result.patient.totalNumberOfStudies}"  />
          </div>
    </h:column>
    <h:column id="matchedSeriesCountColumn">
      <f:facet name="header">
        <h:panelGroup>
         <ice:commandSortHeader columnName="#{searchResultBean.matchedSeriesHeader}" arrow="true" >
	 	<ice:outputText value="#{searchResultBean.matchedSeriesHeader}"/>
    	</ice:commandSortHeader>
        </h:panelGroup>
      </f:facet>
      <div class="#{empty basketBean.patientInBasketMap[result.basketKey] ? '' : 'highlightedData'}">
        <h:outputText value="#{result.seriesCounts}" />
      </div>
    </h:column>
    <h:column id="totalSeriesCountColumn">
          <f:facet name="header">
            <h:panelGroup>
             <ice:commandSortHeader columnName="#{searchResultBean.totalSeriesHeader}" arrow="true" >
	     <ice:outputText value="#{searchResultBean.totalSeriesHeader}"/>
    	</ice:commandSortHeader>
            </h:panelGroup>
          </f:facet>
          <div class="#{empty basketBean.patientInBasketMap[result.basketKey] ? '' : 'highlightedData'}">
            <h:outputText value="#{result.patient.totalNumberOfSeries}" />
          </div>
    </h:column>
    <h:column id="addToBasketColumn">
    <f:facet name="header">
     	<h:commandButton action="#{perNodeResult.addAllPatientInTableToBasket}" image="images/cart-empty.png"  title="Add to Basket"  alt="Add to Basket"  onclick="selectAllInContainingTable('MAINbody:criteriaView:dataForm:tableOfPatientResultTables:0:notWaitingView:patientResultsTable:tbody');"/>
      </f:facet>       
      <div class="#{empty basketBean.patientInBasketMap[result.basketKey] ? '' : 'highlightedData'}">
        <div align="center" class="formFieldWhite">
          <ice:outputLabel for="addPatientToBasketCheckbox"  value="addPatientToBasketCheckbox" style="display:none"/> 
          <h:selectBooleanCheckbox id="addPatientToBasketCheckbox" style="display: none;" 
                                   value="#{result.checked}" />
          <h:commandButton action="#{perNodeResult.addPatientToBasket}"
          			   rendered ="#{empty basketBean.patientInBasketMap[result.basketKey]}"
                                   image="images/add-icon.png" 
                                   title="Add To Basket"
                                   alt="Add To Basket">                         
	<f:setPropertyActionListener target="#{perNodeResult.toAdd}" value="#{result.patient.id}"/>
	
	  </h:commandButton>  
	  <h:commandButton action="#{perNodeResult.removePatientFromBasket}"
          			   rendered ="#{basketBean.patientInBasketMap[result.basketKey]}"
                                   image="images/remove_icon.png" 
                                   title="Remove From Basket"
                                   alt="Remove From Basket">                                                             
	<f:setPropertyActionListener target="#{perNodeResult.toAdd}" value="#{result.patient.id}"/>
          </h:commandButton>                                                           
        </div>
      </div>
    </h:column>                   
  </ice:dataTable>
  <ui:include src="searchResultPaginator.xhtml"/>
</ice:panelGroup>


<!--  text search results  -->
<ice:panelGroup id="patientResultsPanelGroup"  rendered="#{searchResultBean.textResult}">
  <ice:dataTable id="patientResultsTableText" 
                 value="#{perNodeResult.patients}" 
                 var="result" 
                 rows="#{searchResultBean.resultsPerPage}" 
                 scrollable="true" scrollHeight="43.3em"
                 style="border:none;padding-top: 0px;  margin: 0px 0 0 0; text-align: center;"
                 styleClass="contentPage"
                 sortColumn="#{searchResultBean.sortColumnName}"
        	 sortAscending="#{searchResultBean.ascending}"
                 columnWidths="100px,150px,400px,60px,60px,60px">
    <h:column id="collectionIdColumn" style="text-align:center;width:100px">
      <f:facet name="header">
        <h:panelGroup>
       		<ice:commandSortHeader columnName="#{searchResultBean.collectionNameHeader}" arrow="true" >
				<ice:outputText value="#{searchResultBean.collectionNameHeader}" />
			</ice:commandSortHeader>
        </h:panelGroup>
      </f:facet>
      <div class="#{empty basketBean.patientInBasketMap[result.basketKey] ? '' : 'highlightedData'}">
        <h:outputText value="#{result.patient.project}" />
      </div>
    </h:column>
    <h:column id="subjectIdColumn" style="text-align:center;width:150px">
          <f:facet name="header">
            <h:panelGroup>
    		<ice:commandSortHeader columnName="#{searchResultBean.patientHeader}" arrow="true" >
    		<ice:outputText value="#{searchResultBean.patientHeader}"/>
    	</ice:commandSortHeader>         
            </h:panelGroup>
          </f:facet>
          <div class="#{empty basketBean.patientInBasketMap[result.basketKey] ? '' : 'highlightedData'}">
            <h:commandLink id="viewPatientLink"
    	                       value="#{result.patient.subjectId}"
    	                       action="#{perNodeResult.navPatient}"
                           actionListener="#{perNodeResult.viewPatient}" />
          </div>
    </h:column>
    <h:column id="hitColumn" style="text-align:center;width:400px">
      <f:facet name="header">
        <h:panelGroup>
          <ice:commandSortHeader columnName="#{searchResultBean.hitHeader}" arrow="true" >
	      		<ice:outputText value="#{searchResultBean.hitHeader}"/>
    	</ice:commandSortHeader>
        </h:panelGroup>
      </f:facet>
      <div class="#{empty basketBean.patientInBasketMap[result.basketKey] ? '' : 'highlightedData'}">
        <h:outputText value="#{result.hit}"  escape="false"/>
      </div>
    </h:column>
    <h:column id="totalStudiesCountColumn" style="text-align:center;width:60px">
          <f:facet name="header">
            <h:panelGroup>
             <ice:commandSortHeader columnName="#{searchResultBean.totalStudyHeader}" arrow="true" >
	         		<ice:outputText value="#{searchResultBean.totalStudyHeader}"/>
    	</ice:commandSortHeader>
            </h:panelGroup>
          </f:facet>
          <div class="#{empty basketBean.patientInBasketMap[result.basketKey] ? '' : 'highlightedData'}">
            <h:outputText value="#{result.patient.totalNumberOfStudies}"  />
          </div>
    </h:column>
    <h:column id="totalSeriesCountColumn" style="text-align:center;width:60px">
          <f:facet name="header">
            <h:panelGroup>
             <ice:commandSortHeader columnName="#{searchResultBean.totalSeriesHeader}" arrow="true" >
	     <ice:outputText value="#{searchResultBean.totalSeriesHeader}"/>
    	</ice:commandSortHeader>
            </h:panelGroup>
          </f:facet>
          <div class="#{empty basketBean.patientInBasketMap[result.basketKey] ? '' : 'highlightedData'}">
            <h:outputText value="#{result.patient.totalNumberOfSeries}" />
          </div>
    </h:column>
    <h:column id="addToBasketColumn" style="text-align:center;width:60px">
    <f:facet name="header">
     	<h:commandButton action="#{perNodeResult.addAllPatientInTableToBasket}" image="images/cart-empty.png"  title="Add to Basket" alt="Add to Basket"  onclick="selectAllInContainingTable('MAINbody:criteriaView:dataForm:tableOfPatientResultTables:0:notWaitingView:patientResultsTable:tbody');"/>
            
      </f:facet>       
      <div class="#{empty basketBean.patientInBasketMap[result.basketKey] ? '' : 'highlightedData'}">
        <div align="center" class="formFieldWhite">
        <ice:outputLabel for="addPatientToBasketCheckbox"  value="addPatientToBasketCheckbox" style="display:none"/> 
          <h:selectBooleanCheckbox id="addPatientToBasketCheckbox" style="display: none;" 
                                   value="#{result.checked}" />
          <h:commandButton action="#{perNodeResult.addPatientToBasket}"
          			   rendered ="#{empty basketBean.patientInBasketMap[result.basketKey]}"
                                   image="images/add-icon.png" 
                                   title="Add To Basket" alt="Add To Basket">                         
	<f:setPropertyActionListener target="#{perNodeResult.toAdd}" value="#{result.patient.id}"/>
	
	  </h:commandButton>  
	  <h:commandButton action="#{perNodeResult.removePatientFromBasket}"
          			   rendered ="#{basketBean.patientInBasketMap[result.basketKey]}"
                                   image="images/remove_icon.png" 
                                   title="Remove From Basket" alt="Remove From Basket">                                                             
	<f:setPropertyActionListener target="#{perNodeResult.toAdd}" value="#{result.patient.id}"/>
          </h:commandButton>                                                           
        </div>
      </div>
    </h:column>                   
  </ice:dataTable>
  <ui:include src="searchResultPaginatorText.xhtml"/>
</ice:panelGroup>

 
</f:subview>
</ui:composition>